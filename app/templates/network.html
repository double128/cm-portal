{% extends "base.html" %}

{% block styles %}
{{ super() }}
	<link rel='stylesheet' type='text/css' href='{{ url_for('static', filename='network/network.css') }}'/>

	<style>
	.hiddenRow {padding:0 !important;}
	.list-group-hover .list-group-item:hover {
	    background-color: #f5f5f5;
	}
	.active {
		background-color: #3498DB !important;
		border-color: #3498DB !important;
	}
	</style>
{% endblock %}

{% block scripts %}
{{ super() }}
<script type='text/javascript' src='{{ url_for('static', filename='network/network.js') }}'></script>
	<script>
		var formErrors = {% if create_form.errors %}true{% else %}false{% endif %}
		$(document).ready(function() {
			if (formErrors) {
				$('#createNetworkModal').removeClass('fade');
				setTimeout(function() {$('#createNetworkModal').addClass('fade');}, 1000);
				$('#createNetworkModal').modal('show');

			}
		});
		
		$('input[type="text"]').keyup(function() {
			$(this).removeClass('is-invalid');
			var textInput = this.value;
			if (textInput == '{{ create_form.network_name.data }}') {
				$(this).addClass('is-invalid');
			};
			{#$(this).removeClass('is-invalid');#}
			{#if ($(this).val('{{ create_form.network_name.data }}')) {
				$(this).addClass('is-invalid');
			};#}
		});
		
		$('#createNetworkModal').on('hidden.bs.modal', function() {
			$(this).find('#network-create-form').find('input[type="text"]').val('').end();
			$(this).find('#network-create-form').find('input[type="text"]').removeClass('is-invalid');
		});

		{#a$('#accordion-list').on('click', '.list-group-item', function(event) {
			if($(this).hasClass('active')) {
				$(this).removeClass('active');
			} else {
				$(this).addClass('active').siblings().removeClass('active');
			}
		});#}
{# TODO TODO TODO #}

{# DO NOT REMOVE 
$('#createNetworkModal').on('hidden.bs.modal', function(e) {
	document.getElementByTagName('input').reset();
});#}

{# DO NOT REMOVE
$(document).ready(function() {
	console.log('document ready');
	$('#submit-network').click(function(e) {
		console.log('inside click func');
		var url = '{{ url_for("network_create") }}';
		
		$.ajax({
			type: 'post',
			url: url,
			data: $('#network-create-form').serialize(),
			success: function(response) {
				console.log(response);
			},
			error: function(request, status, message) {
				console.log(status);
				console.log(message);
			}
		});

	e.preventDefault();
	});

	$.ajaxSetup({
		beforeSend: function(xhr, settings) {
			if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
				xhr.setRequestHeader('X-CSRFToken', '{{ create_form.hidden_tag() }}')
			}
		}
	});
});

{#$('#submit-button').click(function(e) {
	e.preventDefault();
	$.post(url, data=$('#submit-button').serialize(), function(data) {
		if (data.status == 'error') {
			console.log('error')
			location.reload();
		}
	});
});#}

	
	</script>
{% endblock %}

{% block app_content %}
	<div class='row'>
		<div class='col-md'>
			<div class='d-flex justify-content-end'>
				<a href='#createNetworkModal' class='btn btn-secondary mb-3' data-toggle='modal' data-target='#createNetworkModal'>Create Network</a>
			</div>
		</div>
	</div>

	{% if networks_list %}
	<div id='accordion'>
		<ul class='panel list-group' id='accordion-list'>
			{% for network in networks_list|sort %}
			<li class='list-group-item' data-toggle='collapse' data-target='#{{ network }}' class='accordion-toggle'>{{ network }}</li>
			
			<div class='collapse' id='{{ network }}'>
				<div class='card text-center'>
					<div class='card-header'>
						<ul class='nav nav-pills card-header-pills'>
							<li class='nav-item'>
								<a class='nav-link' data-target='#{{ network }}-view' data-toggle='table'>Information</a>
							</li>
							<li class='nav-item'>
								<a class='nav-link' data-target='#{{ network }}-options' data-toggle='table'>Configurations</a>
							</li>
						</ul>
					</div>
					<div class='card-body'>
						<table class='table' id='{{ network }}-view'>
							<tr>
								<th>Network Name:</th>
								<td>{{ networks_list[network]['name'] }}</td>
							</tr>
							<tr>
								<th>Subnet Name:</th>
								<td>{{ networks_list[network]['subnets']['name'] }}</td>
							</tr>
							<tr>
								<th>Subnet CIDR:</th>
								<td>{{ networks_list[network]['subnets']['cidr'] }}</td>
							</tr>
							<tr>
								<th>Address Pool:</th>
								<td>{{ networks_list[network]['subnets']['allocation_pools'][0]['start'] }}-{{ networks_list[network]['subnets']['allocation_pools'][0]['end'] }}</td>
							</tr>
							<tr>
								<th>Router Name:</th>
								<td>{{ networks_list[network]['router']['name'] }}</td>
							</tr>
							<tr>
								<th>Gateway IP:</th>
								<td>{{ networks_list[network]['subnets']['gateway_ip'] }}</td>
							</tr>
						</table>

						<table class='table' id='{{ network }}-options'>
							<tr>
								<th>AHHHHHHHHHHHHHHHH</th>
								<td>I AM DYENNNGGGG</td>
							</tr>
						</table>
					</div>
				</div>
			</div>
			{% endfor %}
		</ul>
	</div>
		
	{% else %}
	<p>No networks found for this course.</p>
	{% endif %}
	<hr>

	<div id='createNetworkModal' class='modal fade' role='dialog'>
		<div class='modal-dialog modal-dialog-centered'>
			<div class='modal-content'>
				<div class='modal-header'>
					<h4 class='modal-title'>Create Network</h4>
					<button type='button' class='close' data-dismiss='modal'>&times;</button>
				</div>
				<div class='modal-body'>
					<form action='' method='post' id='network-create-form' autocomplete='off'>
						{{ create_form.hidden_tag() }}
						
						{{ wtf.render_field(create_form.network_name) }}
						{#	{{ wtf.render_field(create_form.network_address }} #}

						<div class='form-group required'>
							<label for='network_address'>Network Address</label>
							<div class='input-group'>
								{% if create_form.network_address.errors %}
								<input class="form-control is-invalid" id="network_address" name="network_address" required type="text" value='{{ create_form.network_address.data }}'>
								<div class='input-group-append'>
									<div class='input-group-text' style='border-top-right-radius:0.3rem !important; border-bottom-right-radius:0.3rem !important;'>/24</div>
								</div>
								{% for error in create_form.network_address.errors %}
								<div class='invalid-feedback'>{{ error }}</div>
								{% endfor %}
								
								
								{% else %}
								<input class='form-control' id='network_address' name='network_address' required type='text' value='192.168.0.0'>
								<div class='input-group-append'>
									<div class='input-group-text'>/24</div>
								</div>
								{% endif %}
							</div>
						</div>

						<div class='d-flex justify-content-end'>
							<input id='submit-network' class="submit-button btn btn-success" name="submit" type="submit" value="Submit" onclick='submitButton(this)'>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
{% endblock %}
